<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="/Scripts/jquery.signalR-2.4.2.js"></script>
<script src="/signalr/hubs"></script>
<style>
    .chessboard {
        width: 850px;
        height: 850px;
        background-image: url('/Images/bancotuong.jpg');
    }

    .chessnode {
        position: relative;
        width: 50px;
        height: 50px;
    }

    .chessimgnode {
        width: 50px;
        height: 50px;
        position: relative;
    }
</style>


<div id="app">
    <div class="chessboard">
        <div v-for="item in chessNode" v-if="item !== null">
            <div :id="item.id" class="chessnode">
                <img :src="'/' + item.src" class="chessimgnode" v-bind:style="{ display: item.visible, top: item.top + 'px', left: item.left + 'px'}" />
            </div>
        </div>
    </div>
    {{ message }}
    total record: {{total}}
    <input v-on:click="getTotal" type="button" value="get total" />
    List Student
    <ul id="demo">
        <li v-for="item in students" v-if="item !== null">
            {{item.Id}} {{item.Name}}
        </li>
    </ul>

    class room
    name: <input v-model="classRoom" type="text" value="" />
    class room name: {{classRoom}}

    <input v-on:click="insertClassRoom" type="button" value="insert Class Room" />

    <div>
        <ul id="discussion"></ul>
    </div>
</div>
<script>
    var stObject = {};

    var app = new Vue({
        el: '#app',
        data: {
            message: 'Hello Vue! 112',
            total: 0,
            students: [],
            classRoom: '',
            chessNode: [],
            pos: {},
        },
        methods: {
            getTotal() {
                axios
                    .get('/api/Student/getbyId?Id=1')
                    .then(response => {
                        this.total = response.data.total;
                        this.students = response.data.data;
                        console.log(this.students);
                    })
                    .catch(error => {
                        console.log(error)
                    })
                    .finally()
            },
            insertClassRoom() {
                var payload = { Name: this.classRoom };
                var res = axios.post('/api/ClassRoom/insertClassRoom', payload);
                console.log(res.data);
            },
            getchessNode() {
                var res = axios.post('/api/chess/getchessnode').then(response => {
                    this.chessNode = response.data.chessnode;
                    //this.chessRoom = response.data.data;
                    console.log(response.data.chessnode);
                })
                    .catch(error => {
                        console.log(error)
                    })
                    .finally();
            }
        },
        updated: function () {
            $(".chessnode").draggable({
                start: function (event, ui) {
                    this.pos = ui.helper.position();
                },
                drag: function () {
                    
                },
                stop: function (event, ui) {
                    console.log('top=' + ui.position.top + '  left=' + ui.position.left);

                    let x = this.pos.top;
                    let y = this.pos.left;
                    const pos = ui.position;

                    switch (ui.helper.attr('id')) {
                        case 'xedo1': {
                            if (pos.left < -10 || pos.left > 595 || pos.top > 8 || pos.top < -675) {
                                $('#xedo1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'xedo2': {
                            if (pos.left < -585 || pos.left > 15 || pos.top > 8 || pos.top < -675) {
                                $('#xedo2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'phaodo1': {
                            if (pos.left < -80 || pos.left > 520 || pos.top > 160 || pos.top < -530) {
                                $('#phaodo1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'phaodo2': {
                            if (pos.left < -525 || pos.left > 80 || pos.top > 160 || pos.top < -530) {
                                $('#phaodo2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'mado1': {
                            if (pos.left < -80 || pos.left > 515 || pos.top > 5 || pos.top < -675) {
                                $('#mado1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'mado2': {
                            if (pos.left < -520 || pos.left > 75 || pos.top > 5 || pos.top < -675) {
                                $('#mado2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'tuongdo': {
                            if (pos.left < -80 || pos.left > 80 || pos.top < -155 || pos.top > 5) {
                                $('#tuongdo').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'sido1': {
                            if (pos.left < -5 || pos.left > 155 || pos.top < -160 || pos.top > 5) {
                                $('#sido1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'sido2': {
                            if (pos.left < -155 || pos.left > 5 || pos.top > 5 || pos.top < -155) {
                                $('#sido2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'tuongdo1': {
                            if (pos.left < -160 || pos.left > 445 || pos.top > 5 || pos.top < -305) {
                                $('#tuongdo1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'tuongdo2': {
                            if (pos.left < -445 || pos.left > 155 || pos.top > 5 || pos.top < -305) {
                                $('#tuongdo2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totdo1': {
                            if (pos.left < -10 || pos.left > 585 || pos.top > 5 || pos.top < -455) {
                                $('#totdo1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totdo2': {
                            if (pos.left < -150 || pos.left > 440 || pos.top > 5 || pos.top < -455) {
                                $('#totdo2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totdo3': {
                            if (pos.left < -295 || pos.left > 295 || pos.top > 5 || pos.top < -455) {
                                $('#totdo3').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totdo4': {
                            if (pos.left < -440 || pos.left > 150 || pos.top > 5 || pos.top < -455) {
                                $('#totdo4').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totdo5': {
                            if (pos.left < -580 || pos.left > 10 || pos.top > 5 || pos.top < -455) {
                                $('#totdo5').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'xeden1': {
                            if (pos.left < 0 || pos.left > 585 || pos.top < -5 || pos.top > 670) {
                                $('#xeden1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'xeden2': {
                            if (pos.left < -585 || pos.left > 5 || pos.top < -5 || pos.top > 670) {
                                $('#xeden2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'phaoden1': {
                            if (pos.left < -75 || pos.left > 515 || pos.top < -150 || pos.top > 525) {
                                $('#phaoden1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'phaoden2': {
                            if (pos.left < -515 || pos.left > 75 || pos.top < -150 || pos.top > 525) {
                                $('#phaoden2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'maden1': {
                            if (pos.left < -75 || pos.left > 515 || pos.top < -10 || pos.top > 675) {
                                $('#maden1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'maden2': {
                            if (pos.left < -515 || pos.left > 75 || pos.top < -10 || pos.top > 675) {
                                $('#maden2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }  
                        case 'tuongden': {
                            if (pos.left < -75 || pos.left > 75 || pos.top < -10 || pos.top > 150) {
                                $('#tuongden').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'siden1': {
                            if (pos.left < -5 || pos.left > 5 || pos.top < -5 || pos.top > 150) {
                                $('#siden1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'siden2': {
                            if (pos.left < -155 || pos.left > 155 || pos.top < -5 || pos.top > 150) {
                                $('#siden2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'tuongden1': {
                            if (pos.left < -155 || pos.left > 445 || pos.top < -10 || pos.top > 295) {
                                $('#tuongden1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'tuongden2': {
                            if (pos.left < -445 || pos.left > 150 || pos.top < -10 || pos.top > 295) {
                                $('#tuongden2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totden1': {
                            if (pos.left < -10 || pos.left > 595 || pos.top < -10 || pos.top > 450) {
                                $('#totden1').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totden2': {
                            if (pos.left < -150 || pos.left > 440 || pos.top < -10 || pos.top > 450) {
                                $('#totden2').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totden3': {
                            if (pos.left < -295 || pos.left > 300 || pos.top < -10 || pos.top > 450) {
                                $('#totden3').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totden4': {
                            if (pos.left < -440 || pos.left > 150 || pos.top < -10 || pos.top > 450) {
                                $('#totden4').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                        case 'totden5': {
                            if (pos.left < -580 || pos.left > 10 || pos.top < -10 || pos.top > 450) {
                                $('#totden5').offset({ top: x, left: y });
                                return;
                            }
                            break;
                        }
                    }                    

                    var movelist = [{ id: this.id, top: ui.position.top, left: ui.position.left, visible: true }];

                    var res = axios.post('/api/chess/movenode', movelist).then(response => {
                        this.chessRoom = response.data.data;
                        //alert(response);
                    })
                        .catch(error => {
                            console.log(error)
                        })
                        .finally();

                },
            });
        },
        mounted: function () {
            var chat = $.connection.requestlog;
            $.connection.hub.start().done(function () {

            });
            chat.client.postToClient = function (data) {
                $('#discussion').append('Message' + data + '<br />');

                var result = [];
                result = JSON.parse(data);
                for (var i = 0; i < result.length; i++) {
                    var node = $("#" + result[i].id);
                    node.css({ 'top': result[i].top + 'px' });
                    node.css({ 'left': result[i].left + 'px' });
                    node.css({ 'display': result[i].visible });
                    node.css({ 'top': result[i].top + 'px, left: ' + result[i].left + 'px, display:' + result[i].visible});
                    break;
                }
            };
            this.getchessNode();
        }
    })
</script>
